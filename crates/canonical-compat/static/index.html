<!DOCTYPE html>
<html lang="">
<head>
    <title>Refine</title>
    <style>
        :root {
            --text: black;
            --background: white;

            --meta-background: rgb(242, 242, 247);
            --meta-text: rgb(128, 128, 128);
            --meta-background-selected: rgb(35, 122, 255);
            --meta-text-selected: rgb(204, 228, 255);

            --list-background: rgb(240, 240, 240);
            --list-border: rgb(208, 208, 210);
            --list-hover: rgb(202, 222, 247);

            --option-background: rgb(240, 240, 240);
            --option-disabled: rgb(127, 127, 127);
        }

        body[data-theme='dark'] {
            --text: rgb(217, 217, 217);
            --background: black;

            --meta-background: rgb(28, 28, 30);
            --meta-text: rgb(255, 255, 255);
            --meta-background-selected: rgb(53, 122, 245);
            --meta-text-selected: rgb(211, 229, 253);

            --list-background: rgb(29, 31, 35);
            --list-border: rgb(57, 55, 56);
            --list-hover: rgb(56, 62, 72);

            --option-background: rgb(29, 31, 35);
            --option-disabled: rgb(127, 127, 127);
        }

        .meta {
            background-color: var(--meta-background);
            color: var(--meta-text);
            border-radius: 3.5px;
            padding: 2px 2px 2px 2px;
            cursor: pointer;
        }

        #term {
            line-height: 25px;
            font-family: SFMono-Regular, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        }

        input[type="radio"] {
            display: none;
        }

        .tooltiptext {
            display: none;
        }
        input[type="radio"]:checked ~ .tooltip .tooltiptext {
            display: block;
        }

        input[type="radio"]:checked ~ .tooltip span {
            z-index: 1;
            background-color: var(--meta-background-selected);
            color: var(--meta-text-selected);
        }

        #done {
            display: none;
            color: rgb(103, 166, 213);
        }

        .provers {
            line-height: 20px;
            width: 200px;
            background-color: var(--list-background);
            padding: 5px;
            border-radius: 8.5px;
            border: 1px var(--list-border) solid;
            z-index: 1;
            margin-top: 5px;
            margin-left: -8px;
            box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 20px 5px;
        }

        .fail {
            padding: 5px;
            margin: 0;
        }

        .option {
            background: none;
            color: inherit;
            border: none;
            font: inherit;
            outline: inherit;
            width: 100%;
            padding: 5px;
            cursor: pointer;
            text-align: left;
            border-radius: 3.5px;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

        .type {
            display: none;
            color: rgb(127, 127, 127)
        }

        .option:hover {
            background-color: var(--list-hover)
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", system-ui;
            background-color: var(--background);
            padding: 20px;
            color: var(--text);
        }

        .control {
            color: inherit;
            border: none;
            font: inherit;
            outline: inherit;
            margin-left: 10px;
            padding: 5px 10px;
            border-radius: 8.5px;
            min-width: 30px;
            background-color: var(--option-background);
            cursor: pointer;
        }

        .control:disabled {
            color: var(--option-disabled);
            cursor: default;
        }

        /* Tooltip text */
        .tooltip .tooltiptext {
            position: absolute;
            z-index: 1;
        }

        .tooltip {
            display: inline-block;
        }

        /* .tooltip .tooltiptext::after {
            content: " ";
            position: absolute;
            bottom: 100%;
            left: 15px;
            margin-left: -7px;
            border-width: 7px;
            border-style: solid;
            border-color: transparent transparent rgb(240, 240, 240) transparent;
        } */

        .centered {
            display: flex;
            justify-content: center;
        }

        input {
            cursor: pointer;
        }

        label {
            cursor: pointer;
        }
    </style>

    <script>
        async function update() {
            const res = await fetch('/term', { method: 'POST' });
            const data = await res.json();
            document.getElementById("term").innerHTML = data.html;
            if (data.next) {
                document.getElementById(data.next.toString()).checked = true;
            }
            document.getElementById("done").style.display = (data.next === null) ? 'block' : 'none';
            document.getElementById("undo").disabled = (data.count <= 1);
            document.getElementById("autofill").checked = data.autofill;
        }

        async function assign(meta_id, debruijn, index, def) {
            const res = await fetch('/assign', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ meta_id: meta_id, debruijn: debruijn, index: index, def: def })
            });
            const data = await res.json();
            update();
        }

        async function undo() {
            const res = await fetch('/undo', { method: 'POST' });
            const data = await res.json();
            update();
        }

        async function reset() {
            const res = await fetch('/reset', { method: 'POST' });
            const data = await res.json();
            update();
        }

        async function canonical() {
            document.getElementById("canonical").disabled = true;
            const res = await fetch('/canonical', { method: 'POST' });
            const data = await res.json();
            document.getElementById("canonical").disabled = false;
            update();
        }

        async function canonical1() {
            document.getElementById("canonical1").disabled = true;
            const meta_id = parseInt(new FormData(document.getElementById('term')).get('meta'))
            const res = await fetch('/canonical1', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ meta_id: meta_id }) 
            });
            const data = await res.json();
            document.getElementById("canonical1").disabled = false;
            update();
        }

        async function set(key, value) {
            const res = await fetch('/set', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ key: key, value: value }) 
            });
            const data = await res.json();
            update();
        }

        window.addEventListener('message', (event) => {
            // let p = document.createElement('p');
            // p.appendChild(document.createTextNode('This is a sample paragraph.'));
            // document.body.appendChild(p);
            if (event.data?.type === 'theme') {
                document.body.setAttribute('data-theme', event.data.isDark ? 'dark' : 'light');
            }
        });

        window.onload = function() {
            update();
            document.getElementById("autofill").addEventListener("change", async (e) => {
                set("autofill", e.target.checked)
            });
        }
    </script>
</head>

<body>
    <div style="display: flex;">
        <button class="control" onclick="undo()" id="undo"><svg style="vertical-align:middle;" width="19px" height="19px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15.5 20 7.5 12 15.5 4"></polyline>
          </svg></button>
        <button class="control" onclick="reset()">‚Üª</button>
        <button class="control" onclick="canonical()" id="canonical">Search</button>
        <button class="control" onclick="canonical1()" id="canonical1">Search‚ÇÅ</button>
        <div class="control">
            <input type="checkbox" id="autofill" name="autofill" style="height:15px; width:15px;">
            <label for="autofill" style="line-height:20px;">Autofill</label>
        </div>
    </div>
    <br>
    <form id="term"></form>
    <div class="centered" style="padding-top: 50px;">
        <b id='done'>Goals accomplished üéâ</b>
    </div>
</body>
</html>